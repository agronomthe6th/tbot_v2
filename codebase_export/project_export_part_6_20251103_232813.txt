=== EXPORT PART 6/10 ===

=== –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –° –ü–†–ï–î–´–î–£–©–ï–ì–û –§–ê–ô–õ–ê ===

def safe_datetime_comparison(dt1: datetime, dt2: datetime) -> Optional[int]:
    """
    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ datetime –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤ UTC
    
    Args:
        dt1: –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞
        dt2: –í—Ç–æ—Ä–∞—è –¥–∞—Ç–∞
        
    Returns:
        int: -1 –µ—Å–ª–∏ dt1 < dt2, 0 –µ—Å–ª–∏ —Ä–∞–≤–Ω—ã, 1 –µ—Å–ª–∏ dt1 > dt2, None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
    try:
        dt1_utc = ensure_timezone_aware(dt1)
        dt2_utc = ensure_timezone_aware(dt2)
        
        if dt1_utc is None or dt2_utc is None:
            return None
            
        if dt1_utc < dt2_utc:
            return -1
        elif dt1_utc > dt2_utc:
            return 1
        else:
            return 0
            
    except Exception as e:
        logger.error(f"Error comparing datetimes: {e}")
        return None

def format_utc_for_display(dt: datetime, include_timezone: bool = True) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç UTC –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    
    Args:
        dt: datetime –æ–±—ä–µ–∫—Ç
        include_timezone: –í–∫–ª—é—á–∞—Ç—å –ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ timezone
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    """
    dt_utc = ensure_timezone_aware(dt)
    if dt_utc is None:
        return "Unknown"
        
    if include_timezone:
        return dt_utc.strftime("%Y-%m-%d %H:%M:%S UTC")
    else:
        return dt_utc.strftime("%Y-%m-%d %H:%M:%S")

def validate_datetime_range(start_dt: datetime, end_dt: datetime, max_days: int = 365) -> tuple[bool, str]:
    """
    –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
    
    Args:
        start_dt: –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞
        end_dt: –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞  
        max_days: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
        
    Returns:
        tuple: (is_valid, error_message)
    """
    try:
        start_utc = ensure_timezone_aware(start_dt)
        end_utc = ensure_timezone_aware(end_dt)
        
        if start_utc is None or end_utc is None:
            return False, "Invalid datetime objects"
            
        if start_utc > end_utc:
            return False, "Start date cannot be after end date"
            
        days_diff = days_between_utc(start_utc, end_utc)
        if days_diff > max_days:
            return False, f"Date range too large: {days_diff} days (max {max_days})"
            
        return True, ""
        
    except Exception as e:
        return False, f"Validation error: {e}"

================================================================================
File: frontend/src/App.vue
================================================================================
<!-- frontend/src/App.vue - –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–ê –ù–ê–í–ò–ì–ê–¶–ò–ò -->
<template>
  <div id="app" class="app-container">
    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <AppNavigation v-if="showNavigation" />

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="app-main" :class="{ 'with-navigation': showNavigation }">
      <router-view v-slot="{ Component }">
        <transition name="page" mode="out-in">
          <component :is="Component" />
        </transition>
      </router-view>
    </div>

    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="modals"></div>
    <div id="notifications"></div>

    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div v-if="isGlobalLoading" class="global-loading">
      <div class="loading-spinner"></div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, watch } from 'vue'
import { useRoute } from 'vue-router'
import AppNavigation from './components/AppNavigation.vue'  // ‚úÖ –ò–ú–ü–û–†–¢–ò–†–£–ï–ú –ö–û–ú–ü–û–ù–ï–ù–¢

// –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
const route = useRoute()
const showNavigation = ref(true)
const isGlobalLoading = ref(false)

// Lifecycle
onMounted(() => {
  console.log('üöÄ Trader Tracker App started')
  checkBrowserSupport()
  initializeApp()
})

function checkBrowserSupport() {
  const features = {
    'WebSocket': typeof WebSocket !== 'undefined',
    'localStorage': typeof Storage !== 'undefined',
    'ResizeObserver': typeof ResizeObserver !== 'undefined',
    'IntersectionObserver': typeof IntersectionObserver !== 'undefined',
    'Fetch': typeof fetch !== 'undefined'
  }
  
  const unsupported = Object.entries(features)
    .filter(([_, supported]) => !supported)
    .map(([feature]) => feature)
  
  if (unsupported.length > 0) {
    console.warn('‚ö†Ô∏è Unsupported browser features:', unsupported)
    showBrowserWarning(unsupported)
  } else {
    console.log('‚úÖ All browser features supported')
  }
}

function showBrowserWarning(unsupportedFeatures) {
  const message = `–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: ${unsupportedFeatures.join(', ')}. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä.`
  console.warn(message)
  
  if (unsupportedFeatures.includes('Fetch')) {
    alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞—Ä–µ–ª. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.')
  }
}

async function initializeApp() {
  try {
    console.log('‚úÖ App initialized successfully')
  } catch (error) {
    console.error('‚ùå App initialization failed:', error)
  }
}

function showGlobalLoading() {
  isGlobalLoading.value = true
}

function hideGlobalLoading() {
  isGlobalLoading.value = false
}

defineExpose({
  showGlobalLoading,
  hideGlobalLoading
})
</script>

================================================================================
File: frontend/src/views/AllSignals.vue
================================================================================
<template>
  <div class="min-h-screen bg-trading-bg text-white">
    <div class="max-w-7xl mx-auto p-4">
      
      <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2">üéØ –í—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h1>
        <p class="text-gray-400">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤</p>
      </div>

      <!-- Tabs -->
      <div class="mb-6 border-b border-trading-border">
        <div class="flex gap-4">
          <button
            @click="activeTab = 'signals'"
            :class="[
              'px-4 py-2 font-medium transition-colors',
              activeTab === 'signals'
                ? 'text-trading-green border-b-2 border-trading-green'
                : 'text-gray-400 hover:text-white'
            ]"
          >
            ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã ({{ signalsStats?.total_signals || 0 }})
          </button>
          <button
            @click="activeTab = 'failed'"
            :class="[
              'px-4 py-2 font-medium transition-colors',
              activeTab === 'failed'
                ? 'text-red-500 border-b-2 border-red-500'
                : 'text-gray-400 hover:text-white'
            ]"
          >
            ‚ùå Failed —Å–æ–æ–±—â–µ–Ω–∏—è ({{ signalsStats?.failed_messages || 0 }})
          </button>
        </div>
      </div>

      <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤) -->
      <div v-if="activeTab === 'signals'" class="bg-trading-card rounded-lg border border-trading-border p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">üîç –§–∏–ª—å—Ç—Ä—ã</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <!-- –¢–∏–∫–µ—Ä -->
          <div class="relative">
            <label class="block text-sm font-medium text-gray-300 mb-2">–¢–∏–∫–µ—Ä</label>
            <input 
              v-model="tickerSearch"
              @focus="showTickerDropdown = true"
              @input="handleTickerInput"
              type="text"
              placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å..."
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded text-white focus:border-trading-green focus:outline-none"
            />
            
            <div 
              v-if="showTickerDropdown && filteredTickers.length > 0" 
              class="absolute z-10 w-full mt-1 bg-trading-card border border-trading-border rounded shadow-lg max-h-60 overflow-y-auto"
            >
              <div 
                v-for="ticker in filteredTickers"
                :key="ticker.ticker"
                @click="selectTicker(ticker.ticker)"
                class="px-3 py-2 hover:bg-trading-bg cursor-pointer transition-colors"
              >
                <div class="font-medium">{{ ticker.ticker }}</div>
                <div class="text-xs text-gray-400">{{ ticker.signals_count }} —Å–∏–≥–Ω–∞–ª–æ–≤</div>
              </div>
            </div>
          </div>

          <!-- –ê–≤—Ç–æ—Ä -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–ê–≤—Ç–æ—Ä</label>
            <select 
              v-model="filters.author"
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded text-white focus:border-trading-green focus:outline-none"
            >
              <option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>
              <option v-for="author in availableAuthors" :key="author" :value="author">
                {{ author }}
              </option>
            </select>
          </div>

          <!-- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
            <select 
              v-model="filters.direction"
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded text-white focus:border-trading-green focus:outline-none"
            >
              <option value="all">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
              <option value="long">Long</option>
              <option value="short">Short</option>
              <option value="exit">Exit</option>
            </select>
          </div>

          <!-- –°—Ç–∞—Ç—É—Å -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–°—Ç–∞—Ç—É—Å</label>
            <select 
              v-model="filters.status"
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded text-white focus:border-trading-green focus:outline-none"
            >
              <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
              <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
              <option value="closed">–ó–∞–∫—Ä—ã—Ç—ã–µ</option>
              <option value="stopped">Stopped</option>
            </select>
          </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="flex justify-between items-center">
          <button 
            @click="loadSignals"
            :disabled="isLoading"
            class="px-4 py-2 bg-trading-green hover:bg-green-600 text-black font-medium rounded transition-colors disabled:opacity-50"
          >
            üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
          <button 
            @click="clearFilters"
            class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded transition-colors"
          >
            üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å
          </button>
          <button 
            @click="exportToCSV"
            :disabled="signals.length === 0"
            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded transition-colors disabled:opacity-50"
          >
            üì• –≠–∫—Å–ø–æ—Ä—Ç CSV
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div v-if="isLoading" class="flex justify-center items-center p-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-trading-green"></div>
      </div>

      <!-- Error -->
      <div v-else-if="error" class="bg-red-900/50 border border-red-700 rounded p-4 mb-6">
        <div class="text-red-200">‚ö†Ô∏è {{ error }}</div>
      </div>

      <!-- Signals List -->
      <div v-else-if="activeTab === 'signals'">
        <div v-if="signals.length > 0" class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            <div 
              v-for="signal in signals" 
              :key="signal.id"
              @click="onSignalClick(signal)"
              class="cursor-pointer"
            >
              <SignalCard 
                :signal="signal"
                :show-details="true"
              />
            </div>
          </div>
        </div>

        <div v-else class="p-8 text-center">
          <div class="text-6xl mb-4">üéØ</div>
          <h3 class="text-lg font-semibold mb-2">–°–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
          <p class="text-gray-400 mb-4">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö</p>
          <button 
            @click="clearFilters"
            class="px-4 py-2 bg-trading-green hover:bg-green-600 text-black rounded-md transition-colors"
          >
            üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </div>

      <!-- Failed Messages List -->
      <div v-else-if="activeTab === 'failed'">
        <div v-if="failedMessages.length === 0 && !isLoading" class="text-center py-12 bg-trading-card rounded-lg border border-trading-border">
          <p class="text-gray-400 text-lg">Failed —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
          <p class="text-gray-500 text-sm mt-2">–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω—ã! üéâ</p>
        </div>

        <div v-else class="space-y-4">
          <div
            v-for="message in failedMessages"
            :key="message.id"
            class="bg-trading-card rounded-lg p-4 border border-red-900/50 hover:border-red-500/50 transition-colors"
          >
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-3">
                <span class="text-red-500 font-bold">‚ùå Failed</span>
                <span class="text-sm text-gray-400">ID: {{ message.id }}</span>
                <span class="text-xs text-gray-500">Channel: {{ message.channel_id }}</span>
              </div>
              <span class="text-sm text-gray-400">
                {{ formatDate(message.timestamp) }}
              </span>
            </div>

            <div v-if="message.author" class="flex items-center gap-2 mb-3">
              <span class="text-xs text-gray-400">–ê–≤—Ç–æ—Ä:</span>
              <span class="text-sm text-white">{{ message.author }}</span>
            </div>

            <div class="bg-trading-bg rounded p-3 border border-trading-border">
              <div class="flex justify-between items-center mb-2">
                <div class="text-xs text-gray-400">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è ({{ message.text_length }} —Å–∏–º–≤–æ–ª–æ–≤):</div>
              </div>
              <div class="text-sm text-gray-300 whitespace-pre-wrap">{{ message.text }}</div>
            </div>

            <div class="mt-3 flex gap-2">
              <button
                @click="copyToClipboard(message.text)"
                class="px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 rounded transition-colors"
              >
                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
              </button>
            </div>
          </div>
        </div>

        <!-- Pagination for Failed Messages -->
        <div v-if="failedMessages.length > 0" class="mt-6 flex justify-center gap-2">
          <button
            @click="prevFailedPage"
            :disabled="failedOffset === 0"
            class="px-4 py-2 bg-trading-card border border-trading-border rounded-lg hover:bg-trading-bg transition-colors disabled:opacity-50"
          >
            ‚Üê –ù–∞–∑–∞–¥
          </button>
          <span class="px-4 py-2 text-gray-400">
            –ü–æ–∫–∞–∑–∞–Ω–æ: {{ failedOffset + 1 }} - {{ failedOffset + failedMessages.length }} –∏–∑ {{ failedTotal }}
          </span>
          <button
            @click="nextFailedPage"
            :disabled="failedOffset + failedMessages.length >= failedTotal"
            class="px-4 py-2 bg-trading-card border border-trading-border rounded-lg hover:bg-trading-bg transition-colors disabled:opacity-50"
          >
            –í–ø–µ—Ä–µ–¥ ‚Üí
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onBeforeUnmount, watch } from 'vue'
import tradingAPI from '../services/api.js'
import SignalCard from '../components/SignalCard.vue'

const activeTab = ref('signals')
const isLoading = ref(false)
const error = ref(null)
const signals = ref([])
const failedMessages = ref([])
const signalsResponse = ref(null)
const signalsStats = ref(null)
const availableTickers = ref([])
const availableAuthors = ref([])

const tickerSearch = ref('')
const showTickerDropdown = ref(false)

const filters = ref({
  ticker: '',
  author: '',
  direction: 'all',
  status: 'all',
  period: '',
  order_by: 'timestamp',
  order_dir: 'desc'
})

const currentPage = ref(0)
const pageSize = ref(50)

const failedOffset = ref(0)
const failedLimit = ref(50)
const failedTotal = ref(0)

const filteredTickers = computed(() => {
  if (!tickerSearch.value) return availableTickers.value
  const search = tickerSearch.value.toLowerCase()
  return availableTickers.value.filter(t => 
    t.ticker.toLowerCase().includes(search)
  )
})

watch(activeTab, () => {
  if (activeTab.value === 'signals') {
    loadSignals()
  } else {
    loadFailedMessages()
  }
})

async function loadSignals() {
  try {
    isLoading.value = true
    error.value = null
    
    const params = {
      limit: pageSize.value,
      offset: currentPage.value * pageSize.value,
      order_by: filters.value.order_by,
      order_dir: filters.value.order_dir
    }
    
    if (filters.value.ticker) params.ticker = filters.value.ticker
    if (filters.value.author) params.author = filters.value.author
    if (filters.value.direction && filters.value.direction !== 'all') {
      params.direction = filters.value.direction
    }
    if (filters.value.status && filters.value.status !== 'all') {
      params.status = filters.value.status
    }
    
    const response = await tradingAPI.getSignals(params)
    signalsResponse.value = response
    signals.value = response.signals || []
    
  } catch (err) {
    error.value = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤: ' + err.message
    signals.value = []
  } finally {
    isLoading.value = false
  }
}

async function loadFailedMessages() {
  try {
    isLoading.value = true
    error.value = null
    
    const response = await tradingAPI.getFailedMessages(failedLimit.value, failedOffset.value)
    failedMessages.value = response.messages || []
    failedTotal.value = response.count || 0
    
  } catch (err) {
    error.value = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ failed —Å–æ–æ–±—â–µ–Ω–∏–π: ' + err.message
    failedMessages.value = []
  } finally {
    isLoading.value = false
  }
}

async function loadTickers() {
  try {
    const response = await tradingAPI.getAvailableTickers()
    availableTickers.value = response
  } catch (err) {
    console.error('Failed to load tickers:', err)
  }
}

async function loadAuthors() {
  try {
    const response = await tradingAPI.getAvailableAuthors()
    availableAuthors.value = response
  } catch (err) {
    console.error('Failed to load authors:', err)
  }
}

async function loadStats() {
  try {
    const response = await tradingAPI.getSignalStats()
    signalsStats.value = response
  } catch (err) {
    console.error('Failed to load stats:', err)
  }
}

function handleTickerInput() {
  showTickerDropdown.value = true
}

function selectTicker(ticker) {
  filters.value.ticker = ticker
  tickerSearch.value = ticker
  showTickerDropdown.value = false
  loadSignals()
}

function clearFilters() {
  filters.value = {
    ticker: '',
    author: '',
    direction: 'all',
    status: 'all',
    period: '',
    order_by: 'timestamp',
    order_dir: 'desc'
  }
  tickerSearch.value = ''
  currentPage.value = 0
  loadSignals()
}

function onSignalClick(signal) {
  console.log('Signal clicked:', signal)
}

function handleClickOutside(event) {
  if (!event.target.closest('.relative')) {
    showTickerDropdown.value = false
  }
}

function exportToCSV() {
  const csvContent = [
    ['Ticker', 'Direction', 'Author', 'Timestamp', 'Target Price', 'Stop Loss', 'Take Profit'].join(','),
    ...signals.value.map(s => [
      s.ticker,
      s.direction || '',
      s.author || '',
      s.timestamp || '',
      s.target_price || '',
      s.stop_loss || '',
      s.take_profit || ''
    ].join(','))
  ].join('\n')
  
  const blob = new Blob([csvContent], { type: 'text/csv' })
  const url = window.URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `signals_${new Date().toISOString()}.csv`
  a.click()
  window.URL.revokeObjectURL(url)
}

function nextFailedPage() {
  failedOffset.value += failedLimit.value
  loadFailedMessages()
}

function prevFailedPage() {
  if (failedOffset.value >= failedLimit.value) {
    failedOffset.value -= failedLimit.value
    loadFailedMessages()
  }
}

function formatDate(dateString) {
  if (!dateString) return 'N/A'
  const date = new Date(dateString)
  return date.toLocaleString('ru-RU', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit'
  })
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞')
  }).catch(err => {
    console.error('Failed to copy:', err)
  })
}

onMounted(async () => {
  document.addEventListener('click', handleClickOutside)
  
  await Promise.allSettled([
    loadTickers(),
    loadAuthors(),
    loadStats(),
    loadSignals()
  ])
})

onBeforeUnmount(() => {
  document.removeEventListener('click', handleClickOutside)
})
</script>

<style scoped>
/* Dropdown styles */
</style>

================================================================================
File: frontend/src/views/CleanChart.vue
================================================================================
<!-- frontend/src/views/CleanChart.vue -->
<template>
  <div class="min-h-screen bg-trading-bg text-white">
    <div class="max-w-7xl mx-auto p-4">
      
      <div class="mb-6">
        <h1 class="text-3xl font-bold mb-2">üìä –ß–∏—Å—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫</h1>
        <p class="text-gray-400">–ì—Ä–∞—Ñ–∏–∫ —Å–≤–µ—á–µ–π –±–µ–∑ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</p>
      </div>

      <div class="mb-6">
        <div class="bg-trading-card rounded-lg border border-trading-border p-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            
            <!-- –í—ã–±–æ—Ä —Ç–∏–∫–µ—Ä–∞ -->
            <div class="control-group">
              <label class="control-label">–¢–∏–∫–µ—Ä</label>
              <select 
                v-model="selectedTicker" 
                @change="handleTickerChange"
                class="ticker-select"
                :disabled="isLoading"
              >
                <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–∫–µ—Ä</option>
                <option 
                  v-for="ticker in availableTickers" 
                  :key="ticker.ticker"
                  :value="ticker.ticker"
                >
                  {{ ticker.ticker }}
                </option>
              </select>
            </div>

            <!-- –ü–µ—Ä–∏–æ–¥ -->
            <div class="control-group">
              <label class="control-label">–ü–µ—Ä–∏–æ–¥</label>
              <select 
                v-model="chartDays" 
                @change="handleDaysChange"
                class="period-select"
                :disabled="isLoading"
              >
                <option :value="7">7 –¥–Ω–µ–π</option>
                <option :value="14">14 –¥–Ω–µ–π</option>
                <option :value="30">30 –¥–Ω–µ–π</option>
                <option :value="60">60 –¥–Ω–µ–π</option>
                <option :value="90">90 –¥–Ω–µ–π</option>
                <option :value="180">180 –¥–Ω–µ–π</option>
                <option :value="365">365 –¥–Ω–µ–π</option>
              </select>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
            <div class="control-group">
              <label class="control-label">&nbsp;</label>
              <button 
                @click="handleRefresh"
                :disabled="isLoading"
                class="action-btn refresh w-full"
              >
                {{ isLoading ? '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...' : 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-trading-card rounded-lg border border-trading-border p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-2xl font-bold text-blue-400">{{ selectedTicker || '‚Äî' }}</div>
              <div class="text-sm text-gray-400">–¢–∏–∫–µ—Ä</div>
            </div>
            <div class="text-3xl">üìä</div>
          </div>
        </div>
        
        <div class="bg-trading-card rounded-lg border border-trading-border p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-2xl font-bold text-trading-green">{{ formatPrice(currentPrice) }}</div>
              <div class="text-sm text-gray-400">–¶–µ–Ω–∞</div>
            </div>
            <div class="text-3xl">üí∞</div>
          </div>
        </div>
        
        <div class="bg-trading-card rounded-lg border border-trading-border p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-2xl font-bold" :class="priceChangeColor">
                {{ priceChange ? (priceChange > 0 ? '+' : '') + priceChange.toFixed(2) + '%' : '‚Äî' }}
              </div>
              <div class="text-sm text-gray-400">–ò–∑–º–µ–Ω–µ–Ω–∏–µ</div>
            </div>
            <div class="text-3xl">üìà</div>
          </div>
        </div>

        <div class="bg-trading-card rounded-lg border border-trading-border p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-2xl font-bold text-trading-yellow">{{ chartDays }}</div>
              <div class="text-sm text-gray-400">–î–Ω–µ–π</div>
            </div>
            <div class="text-3xl">üìÖ</div>
          </div>
        </div>
      </div>

      <!-- –û—à–∏–±–∫–∏ -->
      <div v-if="anyError" class="mb-6">
        <div class="error-message">
          ‚ùå {{ anyError }}
          <button 
            @click="clearErrors" 
            class="ml-4 underline hover:no-underline"
          >
            –°–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>

      <!-- –ï–î–ò–ù–´–ô –ì–†–ê–§–ò–ö –ë–ï–ó –°–ò–ì–ù–ê–õ–û–í -->
      <UnifiedTradingChart
        :ticker="selectedTicker"
        :candles-data="candlesData"
        :signals-data="[]"
        :show-signals="false"
        :current-price="currentPrice"
        :is-loading="isLoading"
        :candles-error="candlesError"
        :signals-error="null"
        :chart-height="400"
        @retry="handleRefresh"
      />

    </div>
  </div>
</template>

<script setup>
import { computed, onMounted, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useTradingStore } from '../stores/tradingStore.js'
import UnifiedTradingChart from '../components/charts/UnifiedTradingChart.vue'

// Router
const route = useRoute()
const router = useRouter()

// Store
const store = useTradingStore()

// Computed properties –∏–∑ store
const selectedTicker = computed({
  get: () => store.selectedTicker,
  set: (value) => store.selectedTicker = value
})

const chartDays = computed({
  get: () => store.chartDays,
  set: (value) => store.chartDays = value
})

const candlesData = computed(() => store.candlesData || [])
const availableTickers = computed(() => store.availableTickers || [])
const currentPrice = computed(() => store.currentPrice)
const formattedCandles = computed(() => store.formattedCandles || [])

// Loading states
const isLoading = computed(() => store.isLoading)

// Errors
const candlesError = computed(() => store.candlesError)
const anyError = computed(() => {
  return store.candlesError || store.tickersError
})

// Price change calculation
const priceChange = computed(() => {
  if (!candlesData.value || candlesData.value.length < 2) return null
  
  const firstPrice = candlesData.value[0].open
  const lastPrice = candlesData.value[candlesData.value.length - 1].close
  
  return ((lastPrice - firstPrice) / firstPrice) * 100
})

const priceChangeColor = computed(() => {
  if (!priceChange.value) return 'text-gray-400'
  return priceChange.value > 0 ? 'text-trading-green' : 'text-trading-red'
})

// Methods
async function handleTickerChange() {
  if (selectedTicker.value) {
    console.log('üìÑ Changing ticker to:', selectedTicker.value)
    await store.setTicker(selectedTicker.value)
    
    // –û–±–Ω–æ–≤–ª—è–µ–º URL
    if (route.params.ticker !== selectedTicker.value) {
      await router.replace(`/clean-chart/${selectedTicker.value}`)
    }
  }
}

function handleDaysChange() {
  if (selectedTicker.value) {
    console.log('üìÖ Changing days to:', chartDays.value)
    store.setChartDays(chartDays.value)
  }
}

async function handleRefresh() {
  console.log('üîÑ Force refresh')
  await store.forceReloadData()
}

function clearErrors() {
  store.clearErrors()
}

function formatPrice(price) {
  if (!price) return '0'
  return new Intl.NumberFormat('ru-RU', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 4
  }).format(price)
}

// Lifecycle
onMounted(async () => {
  console.log('üìä CleanChart mounted, route params:', route.params)
  
  try {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–∫–µ—Ä –∏–∑ URL
    const routeTicker = route.params.ticker?.toUpperCase()
    
    if (routeTicker) {
      console.log('üéØ Setting ticker from URL:', routeTicker)
      store.selectedTicker = routeTicker
    }
    
    await store.initialize()
    if (routeTicker && routeTicker !== store.selectedTicker) {
      await store.setTicker(routeTicker)
    }
    
  } catch (error) {
    console.error('‚ùå Error initializing CleanChart:', error)
  }
})

// Watchers
watch(() => route.params.ticker, async (newTicker) => {
  if (newTicker && newTicker.toUpperCase() !== selectedTicker.value) {
    selectedTicker.value = newTicker.toUpperCase()
    await handleTickerChange()
  }
})
</script>

<style scoped>
.control-group {
  @apply space-y-2;
}

.control-label {
  @apply block text-sm font-medium text-gray-300;
}

.ticker-select,
.period-select {
  @apply w-full px-3 py-2 bg-trading-bg border border-trading-border rounded;
  @apply text-white focus:border-trading-green focus:outline-none;
  @apply disabled:opacity-50 disabled:cursor-not-allowed;
}

.ticker-selector {
  @apply flex items-center space-x-2;
}

.action-btn {
  @apply flex items-center justify-center space-x-2 px-4 py-2 rounded;
  @apply font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed;
  @apply transition-all duration-200;
}

.action-btn.refresh {
  @apply bg-trading-green text-black hover:bg-green-400;
}

.error-message {
  @apply bg-red-900/50 border border-red-700 rounded p-3 text-red-200;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 640px) {
  .control-group {
    @apply space-y-2;
  }
}
</style>

================================================================================
File: frontend/src/views/ConsensusPage.vue
================================================================================
<template>
  <div class="min-h-screen bg-trading-bg text-white p-4">
    <div class="max-w-7xl mx-auto">
      
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2">üî• –ö–æ–Ω—Å–µ–Ω—Å—É—Å –¢—Ä–µ–π–¥–µ—Ä–æ–≤</h1>
        <p class="text-gray-400">
          –ú–æ–º–µ–Ω—Ç—ã –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–π–¥–µ—Ä–æ–≤ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥–∞—é—Ç —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤
        </p>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div v-if="stats" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-trading-card p-4 rounded-lg border border-trading-border">
          <div class="text-gray-400 text-sm mb-1">–í—Å–µ–≥–æ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–≤</div>
          <div class="text-2xl font-bold">{{ stats.total || 0 }}</div>
        </div>
        
        <div class="bg-trading-card p-4 rounded-lg border border-trading-border">
          <div class="text-gray-400 text-sm mb-1">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
          <div class="text-2xl font-bold text-trading-green">
            {{ stats.by_status?.active || 0 }}
          </div>
        </div>
        
        <div class="bg-trading-card p-4 rounded-lg border border-trading-border">
          <div class="text-gray-400 text-sm mb-1">–°—Ä–µ–¥–Ω—è—è —Å–∏–ª–∞</div>
          <div class="text-2xl font-bold">
            {{ Math.round(stats.avg_strength || 0) }}/100
          </div>
        </div>
        
        <div class="bg-trading-card p-4 rounded-lg border border-trading-border">
          <div class="text-gray-400 text-sm mb-1">–ü–µ—Ä–∏–æ–¥</div>
          <div class="text-2xl font-bold">{{ stats.period_days || 30 }} –¥–Ω–µ–π</div>
        </div>
      </div>

      <!-- –§–∏–ª—å—Ç—Ä—ã -->
      <div class="bg-trading-card p-4 rounded-lg border border-trading-border mb-6">
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
          <div>
            <label class="block text-sm text-gray-400 mb-2">–¢–∏–∫–µ—Ä</label>
            <input 
              v-model="filters.ticker" 
              @change="applyFilters"
              type="text" 
              placeholder="SBER, GAZP..."
              class="w-full bg-trading-bg border border-trading-border rounded px-3 py-2 text-white"
            />
          </div>
          
          <div>
            <label class="block text-sm text-gray-400 mb-2">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
            <select 
              v-model="filters.direction" 
              @change="applyFilters"
              class="w-full bg-trading-bg border border-trading-border rounded px-3 py-2 text-white"
            >
              <option value="">–í—Å–µ</option>
              <option value="long">LONG</option>
              <option value="short">SHORT</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm text-gray-400 mb-2">–°—Ç–∞—Ç—É—Å</label>
            <select 
              v-model="filters.status" 
              @change="applyFilters"
              class="w-full bg-trading-bg border border-trading-border rounded px-3 py-2 text-white"
            >
              <option value="all">–í—Å–µ</option>
              <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
              <option value="closed">–ó–∞–∫—Ä—ã—Ç—ã–µ</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm text-gray-400 mb-2">–ú–∏–Ω. —Å–∏–ª–∞</label>
            <input 
              v-model.number="filters.min_strength" 
              @change="applyFilters"
              type="number" 
              min="0" 
              max="100"
              placeholder="0-100"
              class="w-full bg-trading-bg border border-trading-border rounded px-3 py-2 text-white"
            />
          </div>
          
          <div>
            <label class="block text-sm text-gray-400 mb-2">–ü–µ—Ä–∏–æ–¥</label>
            <select 
              v-model.number="filters.days_back" 
              @change="applyFilters"
              class="w-full bg-trading-bg border border-trading-border rounded px-3 py-2 text-white"
            >
              <option :value="7">7 –¥–Ω–µ–π</option>
              <option :value="30">30 –¥–Ω–µ–π</option>
              <option :value="90">90 –¥–Ω–µ–π</option>
            </select>
          </div>
        </div>
        
        <div class="mt-4 flex gap-2">
          <button 
            @click="resetFilters"
            class="px-4 py-2 bg-trading-bg border border-trading-border rounded hover:bg-gray-700 transition-colors"
          >
            –°–±—Ä–æ—Å–∏—Ç—å
          </button>
          
          <button 
            @click="triggerDetection"
            :disabled="isDetecting"
            class="px-4 py-2 bg-trading-green text-black rounded hover:bg-green-500 transition-colors disabled:opacity-50"
          >
            {{ isDetecting ? '–ü–æ–∏—Å–∫...' : 'üîç –ù–∞–π—Ç–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å—ã' }}
          </button>
        </div>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–≤ -->
      <div v-if="isLoading" class="text-center py-12">
        <div class="text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–≤...</div>
      </div>

      <div v-else-if="error" class="bg-red-900/20 border border-red-500 rounded-lg p-4 mb-6">
        <div class="text-red-400">{{ error }}</div>
      </div>

      <div v-else-if="consensusEvents.length === 0" class="text-center py-12">
        <div class="text-gray-400 mb-4">–ö–æ–Ω—Å–µ–Ω—Å—É—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
        <button 
          @click="triggerDetection"
          class="px-6 py-3 bg-trading-green text-black rounded-lg hover:bg-green-500 transition-colors"
        >
          üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–≤
        </button>
      </div>

      <div v-else class="space-y-4">
        <div 
          v-for="consensus in consensusEvents" 
          :key="consensus.id"
          @click="showConsensusDetails(consensus)"
          class="bg-trading-card p-4 rounded-lg border border-trading-border hover:border-trading-green transition-colors cursor-pointer"
        >
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="text-2xl font-bold">{{ consensus.ticker }}</div>
              <div 
                :class="{
                  'text-trading-green': consensus.direction === 'long',
                  'text-trading-red': consensus.direction === 'short'
                }"
                class="px-3 py-1 rounded text-sm font-semibold"
              >
                {{ consensus.direction === 'long' ? 'üìà LONG' : 'üìâ SHORT' }}
              </div>
              
              <div class="px-3 py-1 bg-trading-bg rounded text-sm">
                üí™ –°–∏–ª–∞: {{ consensus.consensus_strength }}/100
              </div>
            </div>
            
            <div class="text-right text-sm text-gray-400">
              {{ formatDate(consensus.detected_at) }}
            </div>
          </div>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3">
            <div>
              <div class="text-gray-400">–¢—Ä–µ–π–¥–µ—Ä–æ–≤</div>
              <div class="font-semibold">{{ consensus.traders_count }}</div>
            </div>
            
            <div>
              <div class="text-gray-400">–°–∏–≥–Ω–∞–ª–æ–≤</div>
              <div class="font-semibold">{{ consensus.signals_count }}</div>
            </div>
            
            <div>
              <div class="text-gray-400">–û–∫–Ω–æ</div>
              <div class="font-semibold">{{ consensus.window_minutes }} –º–∏–Ω</div>
            </div>
            
            <div>
              <div class="text-gray-400">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
              <div class="font-semibold">
                {{ consensus.avg_entry_price ? consensus.avg_entry_price.toFixed(2) + ' ‚ÇΩ' : '‚Äî' }}
              </div>
            </div>
          </div>
          
          <div v-if="consensus.authors && consensus.authors.length > 0" class="flex flex-wrap gap-2">
            <span 
              v-for="author in consensus.authors.slice(0, 5)" 
              :key="author"
              class="px-2 py-1 bg-trading-bg rounded text-xs text-gray-300"
            >
              {{ author }}
            </span>
            <span 
              v-if="consensus.authors.length > 5"
              class="px-2 py-1 bg-trading-bg rounded text-xs text-gray-400"
            >
              +{{ consensus.authors.length - 5 }}
            </span>
          </div>
        </div>
      </div>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
      <div v-if="totalConsensus > filters.limit" class="mt-6 flex justify-center gap-2">
        <button 
          @click="prevPage"
          :disabled="currentPage === 1"
          class="px-4 py-2 bg-trading-card border border-trading-border rounded hover:bg-gray-700 disabled:opacity-50 transition-colors"
        >
          ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è
        </button>
        
        <div class="px-4 py-2 bg-trading-card border border-trading-border rounded">
          –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ currentPage }} –∏–∑ {{ totalPages }}
        </div>
        
        <button 
          @click="nextPage"
          :disabled="currentPage === totalPages"
          class="px-4 py-2 bg-trading-card border border-trading-border rounded hover:bg-gray-700 disabled:opacity-50 transition-colors"
        >
          –°–ª–µ–¥—É—é—â–∞—è ‚Üí
        </button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { tradingAPI } from '../services/api'

const isLoading = ref(false)
const isDetecting = ref(false)
const error = ref(null)
const consensusEvents = ref([])
const stats = ref(null)
const totalConsensus = ref(0)
const currentPage = ref(1)

const filters = ref({
  ticker: '',
  direction: '',
  status: 'all',
  min_strength: null,
  days_back: 30,
  limit: 20
})

const totalPages = computed(() => {
  return Math.ceil(totalConsensus.value / filters.value.limit)
})

async function loadConsensusEvents() {
  isLoading.value = true
  error.value = null
  
  try {
    console.log('üìä Loading consensus events...')
    
    const offset = (currentPage.value - 1) * filters.value.limit
    
    const response = await tradingAPI.getConsensusEvents({
      ticker: filters.value.ticker || null,
      direction: filters.value.direction || null,
      status: filters.value.status,
      min_strength: filters.value.min_strength,
      days_back: filters.value.days_back,
      limit: filters.value.limit,
      offset: offset
    })
    
    consensusEvents.value = response.consensus_events || []
    totalConsensus.value = response.count || 0
    
    console.log('‚úÖ Loaded consensus events:', consensusEvents.value.length)
    
  } catch (err) {
    console.error('‚ùå Error loading consensus events:', err)
    error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–≤'
  } finally {
    isLoading.value = false
  }
}

async function loadStats() {
  try {
    const response = await tradingAPI.getConsensusStats(
      filters.value.ticker || null,
      filters.value.days_back
    )
    stats.value = response
  } catch (err) {
    console.error('‚ùå Error loading consensus stats:', err)
  }
}

function applyFilters() {
  currentPage.value = 1
  loadConsensusEvents()
  loadStats()
}

function resetFilters() {
  filters.value = {
    ticker: '',
    direction: '',
    status: 'all',
    min_strength: null,
    days_back: 30,
    limit: 20
  }
  currentPage.value = 1
  loadConsensusEvents()
  loadStats()
}

async function triggerDetection() {
  isDetecting.value = true
  
  try {
    console.log('üîç Triggering consensus detection...')
    
    await tradingAPI.triggerConsensusDetection(
      filters.value.ticker || null,
      24
    )
    
    setTimeout(() => {
      loadConsensusEvents()
      loadStats()
    }, 2000)
    
  } catch (err) {
    console.error('‚ùå Error triggering detection:', err)
    error.value = err.message
  } finally {
    setTimeout(() => {
      isDetecting.value = false
    }, 2000)
  }
}

function showConsensusDetails(consensus) {
  console.log('üìä Show consensus details:', consensus)
}

function formatDate(dateString) {
  const date = new Date(dateString)
  const now = new Date()
  const diffMs = now - date
  const diffMins = Math.floor(diffMs / 60000)
  const diffHours = Math.floor(diffMs / 3600000)
  
  if (diffMins < 60) {
    return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`
  } else if (diffHours < 24) {
    return `${diffHours} —á –Ω–∞–∑–∞–¥`
  } else {
    return date.toLocaleDateString('ru-RU', {
      day: '2-digit',
      month: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    })
  }
}

function nextPage() {
  if (currentPage.value < totalPages.value) {
    currentPage.value++
    loadConsensusEvents()
  }
}

function prevPage() {
  if (currentPage.value > 1) {
    currentPage.value--
    loadConsensusEvents()
  }
}

onMounted(() => {
  console.log('üöÄ ConsensusPage mounted')
  loadConsensusEvents()
  loadStats()
})
</script>

================================================================================
File: frontend/src/views/DataDiagnostics.vue
================================================================================
<!-- frontend/src/views/DataDiagnostics.vue -->
<template>
  <div class="min-h-screen bg-trading-bg text-white">
    <div class="max-w-7xl mx-auto p-4">
      
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2">üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
        <p class="text-gray-400">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</p>
      </div>

      <!-- –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
      <div class="bg-trading-card rounded-lg border border-trading-border p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <button 
            @click="checkSystemStatus"
            :disabled="isLoading"
            class="px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50"
          >
            üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
          </button>
          
          <button 
            @click="loadAllInstruments"
            :disabled="isLoading"
            class="px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50"
          >
            üìã –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
          </button>
          
          <button 
            @click="refreshAllData"
            :disabled="isLoading"
            class="px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors disabled:opacity-50"
          >
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ
          </button>
        </div>
      </div>

      <!-- –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ -->
      <div class="bg-trading-card rounded-lg border border-trading-border p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">üéØ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–¢–∏–∫–µ—Ä</label>
            <select 
              v-model="selectedTicker" 
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded-md text-white"
            >
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–∫–µ—Ä</option>
              <option v-for="ticker in availableTickers" :key="ticker.ticker" :value="ticker.ticker">
                {{ ticker.ticker }} - {{ ticker.name }}
              </option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–ü–µ—Ä–∏–æ–¥ (–¥–Ω–∏)</label>
            <select 
              v-model="selectedPeriod" 
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded-md text-white"
            >
              <option value="30">30 –¥–Ω–µ–π</option>
              <option value="90">90 –¥–Ω–µ–π</option>
              <option value="180">180 –¥–Ω–µ–π</option>
              <option value="365">1 –≥–æ–¥</option>
              <option value="730">2 –≥–æ–¥–∞</option>
              <option value="1095">3 –≥–æ–¥–∞</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
            <select 
              v-model="selectedInterval" 
              class="w-full px-3 py-2 bg-trading-bg border border-trading-border rounded-md text-white"
            >
              <option value="5min">5 –º–∏–Ω—É—Ç</option>
              <option value="hour">1 —á–∞—Å</option>
              <option value="day">1 –¥–µ–Ω—å</option>
            </select>
          </div>
          
          <div class="flex items-end">
            <button 
              @click="analyzeInstrument"
              :disabled="!selectedTicker || isLoading"
              class="w-full px-4 py-2 bg-trading-green hover:bg-opacity-80 rounded-lg transition-colors disabled:opacity-50"
            >
              üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
            </button>
          </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ -->
        <div v-if="analysisResult" class="mt-4 p-4 bg-trading-bg rounded-lg border border-trading-border">
          <h3 class="font-semibold mb-2">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ {{ analysisResult.ticker }}</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-blue-400">{{ analysisResult.available_candles || 0 }}</div>
              <div class="text-sm text-gray-400">–î–æ—Å—Ç—É–ø–Ω–æ —Å–≤–µ—á–µ–π</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold" :class="coverageColor">{{ analysisResult.coverage_percentage || 0 }}%</div>
              <div class="text-sm text-gray-400">–ü–æ–∫—Ä—ã—Ç–∏–µ</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-yellow-400">{{ analysisResult.max_days_available || 0 }}</div>
              <div class="text-sm text-gray-400">–ú–∞–∫—Å. –¥–Ω–µ–π</div>
            </div>
          </div>
          
          <div v-if="analysisResult.date_range" class="mt-4 text-sm text-gray-400">
            <div><strong>–ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö:</strong> {{ formatDate(analysisResult.date_range.start) }} - {{ formatDate(analysisResult.date_range.end) }}</div>
            <div><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ formatDate(analysisResult.last_update) }}</div>
          </div>
          
          <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
          <div v-if="analysisResult.coverage_percentage < 101" class="mt-4">
            <button 
              @click="loadMissingData"
              :disabled="isLoadingData"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50"
            >
              {{ isLoadingData ? '‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º...' : 'üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ' }}
            </button>
          </div>
        </div>
      </div>

      <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã -->
      <div v-if="systemStats" class="bg-trading-card rounded-lg border border-trading-border p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
          <div class="bg-trading-bg rounded-lg p-4 border border-trading-border text-center">
            <div class="text-2xl font-bold text-blue-400">{{ systemStats.total_instruments || 0 }}</div>
            <div class="text-sm text-gray-400">–í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</div>
          </div>
          
          <div class="bg-trading-bg rounded-lg p-4 border border-trading-border text-center">
            <div class="text-2xl font-bold text-green-400">{{ formatNumber(systemStats.total_candles) || 0 }}</div>
            <div class="text-sm text-gray-400">–í—Å–µ–≥–æ —Å–≤–µ—á–µ–π</div>
          </div>
          
          <div class="bg-trading-bg rounded-lg p-4 border border-trading-border text-center">
            <div class="text-2xl font-bold text-yellow-400">{{ systemStats.instruments_with_data || 0 }}</div>
            <div class="text-sm text-gray-400">–° –¥–∞–Ω–Ω—ã–º–∏</div>
          </div>
          
          <div class="bg-trading-bg rounded-lg p-4 border border-trading-border text-center">
            <div class="text-2xl font-bold text-purple-400">{{ systemStats.total_signals || 0 }}</div>
            <div class="text-sm text-gray-400">–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤</div>
          </div>
        </div>
        
        <div v-if="systemStats.last_update" class="text-sm text-gray-400">
          <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ formatDate(systemStats.last_update) }}
        </div>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
      <div v-if="allInstruments.length > 0" class="bg-trading-card rounded-lg border border-trading-border p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">üìã –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ({{ allInstruments.length }})</h2>
          
          <!-- –§–∏–ª—å—Ç—Ä -->
          <div class="flex gap-2">
            <input 
              v-model="instrumentFilter"
              placeholder="–ü–æ–∏—Å–∫..."
              class="px-3 py-1 bg-trading-bg border border-trading-border rounded text-white text-sm"
            >
            <select 
              v-model="dataFilter"
              class="px-3 py-1 bg-trading-bg border border-trading-border rounded text-white text-sm"
            >
              <option value="all">–í—Å–µ</option>
              <option value="with_data">–° –¥–∞–Ω–Ω—ã–º–∏</option>
              <option value="no_data">–ë–µ–∑ –¥–∞–Ω–Ω—ã—Ö</option>
              <option value="poor_data">–ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö</option>
            </select>
          </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-trading-border">
                <th class="text-left py-2">–¢–∏–∫–µ—Ä</th>
                <th class="text-left py-2">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th class="text-center py-2">–°–≤–µ—á–µ–π</th>
                <th class="text-center py-2">–ü–æ–∫—Ä—ã—Ç–∏–µ</th>
                <th class="text-center py-2">–ü–æ—Å–ª–µ–¥–Ω—è—è</th>
                <th class="text-center py-2">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              <tr 
                v-for="instrument in filteredInstruments" 
                :key="instrument.ticker"
                class="border-b border-trading-border hover:bg-trading-bg hover:bg-opacity-50"
              >
                <td class="py-2 font-mono">{{ instrument.ticker }}</td>
                <td class="py-2">{{ instrument.name }}</td>
                <td class="py-2 text-center">{{ formatNumber(instrument.candles_count) || 0 }}</td>
                <td class="py-2 text-center">
                  <span 
                    class="px-2 py-1 rounded text-xs font-medium"
                    :class="getCoverageClass(instrument.coverage_percentage)"
                  >
                    {{ instrument.coverage_percentage || 0 }}%
                  </span>
                </td>
                <td class="py-2 text-center text-xs text-gray-400">
                  {{ instrument.latest_candle ? formatDate(instrument.latest_candle) : '–ù–µ—Ç' }}
                </td>
                <td class="py-2 text-center">
                  <button 
                    @click="loadInstrumentData(instrument.ticker)"
                    :disabled="isLoadingData"
                    class="px-2 py-1 bg-trading-green hover:bg-opacity-80 rounded text-xs transition-colors disabled:opacity-50"
                  >
                    üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div v-if="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-trading-card rounded-lg p-6 text-center">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-trading-green mx-auto mb-4"></div>
          <div class="text-white">{{ loadingMessage || '–ó–∞–≥—Ä—É–∑–∫–∞...' }}</div>
        </div>
      </div>

    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { tradingAPI } from '../services/api.js'

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
const isLoading = ref(false)
const isLoadingData = ref(false)
const loadingMessage = ref('')

// –í—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
const selectedTicker = ref('')
const selectedPeriod = ref(365)
const selectedInterval = ref('5min')

// –§–∏–ª—å—Ç—Ä—ã
const instrumentFilter = ref('')
const dataFilter = ref('all')

// –î–∞–Ω–Ω—ã–µ
const availableTickers = ref([])
const allInstruments = ref([])
const systemStats = ref(null)
const analysisResult = ref(null)

// Computed
const coverageColor = computed(() => {
  if (!analysisResult.value) return 'text-gray-400'
  const percentage = analysisResult.value.coverage_percentage || 0
  if (percentage >= 80) return 'text-green-400'

=== –ö–û–î –û–ë–†–´–í–ê–ï–¢–°–Ø. –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –í –°–õ–ï–î–£–Æ–©–ï–ú –§–ê–ô–õ–ï ===

