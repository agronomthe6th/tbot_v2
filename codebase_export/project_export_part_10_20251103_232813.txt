=== EXPORT PART 10/10 ===

=== –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –° –ü–†–ï–î–´–î–£–©–ï–ì–û –§–ê–ô–õ–ê ===

                    class="bg-blue-900 text-blue-400 px-2 py-1 rounded text-xs font-mono"
                  >
                    {{ gIndex + 1 }}: {{ group }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π -->
          <div v-else class="text-center py-8 text-gray-400">
            <div class="text-4xl mb-2">üîç</div>
            <p>–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
            <p class="text-sm mt-1">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω</p>
          </div>

          <!-- –¢–µ–∫—Å—Ç —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π -->
          <div v-if="results.matches_count > 0" class="mt-4">
            <div class="text-gray-400 text-sm mb-2">–¢–µ–∫—Å—Ç —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:</div>
            <div class="bg-gray-900 px-3 py-2 rounded text-white text-sm leading-relaxed font-mono whitespace-pre-wrap">
              {{ highlightedText }}
            </div>
          </div>
        </div>

        <!-- –û—à–∏–±–∫–∞ -->
        <div v-if="error" class="bg-red-900 border border-red-700 rounded-lg p-4">
          <div class="text-red-400 font-semibold mb-1">–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
          <div class="text-red-300 text-sm">{{ error }}</div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { tradingAPI } from '../../services/api'

const props = defineProps({
  pattern: {
    type: Object,
    required: true
  }
})

defineEmits(['close'])

const testText = ref('')
const testing = ref(false)
const results = ref(null)
const error = ref(null)

const highlightedText = computed(() => {
  if (!results.value || results.value.matches_count === 0) return ''
  
  let text = testText.value
  const matches = [...results.value.matches].sort((a, b) => b.start - a.start)
  
  for (const match of matches) {
    const before = text.substring(0, match.start)
    const matched = text.substring(match.start, match.end)
    const after = text.substring(match.end)
    text = before + `‚ü™${matched}‚ü´` + after
  }
  
  return text
})

async function testPattern() {
  if (!testText.value.trim()) return
  
  testing.value = true
  error.value = null
  results.value = null
  
  try {
    const response = await tradingAPI.post('/api/patterns/test', {
      pattern: props.pattern.pattern,
      text: testText.value
    })
    
    if (response.data.success) {
      results.value = response.data
    } else {
      error.value = response.data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'
    }
  } catch (err) {
    console.error('Failed to test pattern:', err)
    error.value = err.response?.data?.detail || '–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞'
  } finally {
    testing.value = false
  }
}

function loadExample() {
  const examples = {
    'ticker': '$SBER –∫—É–ø–∏–ª –ø–æ 250‚ÇΩ',
    'direction_long': '–í—Ö–æ–¥ –ª–æ–Ω–≥ –ø–æ 100‚ÇΩ –æ—Ç —Ç–µ–∫—É—â–∏—Ö',
    'direction_short': '–û—Ç–∫—Ä—ã–ª —à–æ—Ä—Ç –ø–æ 50',
    'operation_exit': '–ó–∞–∫—Ä—ã–ª –ª–æ–Ω–≥ —Å –ø—Ä–æ—Ñ–∏—Ç–æ–º',
    'trading_keyword': '–û—Ç–∫—Ä—ã—Ç–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –ª–æ–Ω–≥',
    'author': '#TraderPro - —Å–∏–≥–Ω–∞–ª –Ω–∞ –ø–æ–∫—É–ø–∫—É',
    'price_target': '–¶–µ–ª—å: 300‚ÇΩ, —Å—Ç–æ–ø: 240‚ÇΩ',
    'price_stop': '–°—Ç–æ–ø –ø–æ –ª–æ–Ω–≥—É: 95‚ÇΩ',
    'price_take': '–¢–µ–π–∫ –ø—Ä–æ—Ñ–∏—Ç: 120‚ÇΩ',
    'garbage': '–ë–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∫–∞–Ω–∞–ª–µ @copybot'
  }
  
  const category = props.pattern.category
  const baseExample = examples[category] || '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏'
  
  testText.value = `${baseExample}\n\n$SBER –ª–æ–Ω–≥ –ø–æ 250‚ÇΩ\n–¶–µ–ª—å: 280‚ÇΩ\n–°—Ç–æ–ø: 240‚ÇΩ\n\n#Trader - —Å–¥–µ–ª–∫–∞ –¥–Ω—è`
}
</script>
